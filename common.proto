syntax = "proto3";

package protobuff;
option go_package = "gitlab.com/xbackend/buffers/protobuff";

message TokenClaims {
    string user_id = 1;
    string role = 2;
    string project_id = 3;
}

message UserProject {
    string project_id = 1;
    repeated string roles = 2;
}

message LoginRequest {
    string username = 1;
    string email = 2;
    string secret = 3;
}

message RegisteredUsers {
    string key = 1;
    string name = 2;
    string username = 3;
    string email = 4;
    string secret = 5;
    uint64 token_refresh_val = 6;
    repeated UserProject accounts = 7;
    string avatar = 8;
}

// data

message UserMeta {
    string id = 1;
    string avatar = 2;
    string name = 3;
    string role = 4;
}

message MetaField {
    string created_at = 1;
    string updated_at = 2;
    UserMeta created_by = 3;
    UserMeta last_modified_by = 4;
}

// user project
message Project {
    string key = 1; //exclude:"true"`
    string id = 2;
    string user_id = 3;
    string project_name = 4;
    string project_description = 5;
    UserDefinedSchema schema = 6;
}

message UserDefinedSchema {
    repeated ModelType models = 1;
    repeated CloudFunction functions = 2;
}

message ModelType {
    string name = 1;
    repeated FieldInfo fields = 2;
    repeated ConnectionType connections = 3;
}

message CloudFunction {
    string id = 1;
    string name = 2;
    CloudFunctionRequestType request = 3;
    CloudFunctionResponseType response = 4;
}

message FieldInfo {
    string name = 1;
    string type = 2;
    bool required = 3;
    repeated SubFieldInfo fields = 4; // to avoid a loop
    repeated string locals = 5;
}

message SubFieldInfo {
    string name = 1;
    string type = 2;
    bool required = 3;
}

message ConnectionType {
    string type = 1;
    string document = 2;
    string relation = 3;
}

message CloudFunctionRequestType {
    string type = 1;
    string document = 2;
    repeated FieldInfo params = 3;
}

message CloudFunctionResponseType {
    string type = 1;
    string document = 2;
    string relation = 3;
}
